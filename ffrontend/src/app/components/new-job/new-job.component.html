<app-navbar [title]="'Create New Job'"></app-navbar>

<div class="profile-container">
  <div class="cards-container">
    <div class="new-job-container">
      <h2 class="form-title">Create New Job</h2>

      <form [formGroup]="jobForm">
        <div class="form-group" [class.loading]="isLoadingForm">
          <label>Job Title</label>
          <input type="text" formControlName="cim">
          <div class="error-message" *ngIf="showError('cim')">
            {{ getErrorMessage('cim') }}
          </div>
        </div>

        <div class="form-group" [class.loading]="isLoadingForm">
          <label>Description</label>
          <textarea formControlName="leiras" rows="4"></textarea>
          <div class="error-message" *ngIf="showError('leiras')">
            {{ getErrorMessage('leiras') }}
          </div>
        </div>

        <div class="form-group" [class.loading]="isLoadingForm">
          <label>Work Schedule</label>
          <select formControlName="munkarend">
            <option value="">Select schedule</option>
            <option *ngFor="let option of workScheduleOptions" [value]="option.value">
              {{option.label}}
            </option>
          </select>
          <div class="error-message" *ngIf="showError('munkarend')">
            {{ getErrorMessage('munkarend') }}
          </div>
        </div>

        <div class="form-group" [class.loading]="isLoadingForm">
          <label>Short Description</label>
          <textarea formControlName="rovidleiras" rows="2"></textarea>
          <div class="error-message" *ngIf="showError('rovidleiras')">
            {{ getErrorMessage('rovidleiras') }}
          </div>
        </div>

        <div class="form-group" [class.loading]="isLoadingForm">
          <label>Location</label>
          <input type="text" formControlName="telepely">
          <div class="error-message" *ngIf="showError('telepely')">
            {{ getErrorMessage('telepely') }}
          </div>
        </div>

        <div class="form-group" [class.loading]="isLoadingForm">
          <label>Deadline</label>
          <input type="date" formControlName="kitoltesihatarido" [min]="getFormattedDate()">
          <div class="error-message" *ngIf="showError('kitoltesihatarido')">
            {{ getErrorMessage('kitoltesihatarido') }}
          </div>
        </div>

        <button class="submit-button" (click)="onSubmit()" [disabled]="isSubmitting || jobForm.invalid">
          {{ isSubmitting ? '' : 'Create Job' }}
        </button>
      </form>
    </div>

    <div class="turns-card" [class.loading]="isLoadingTurns">
      <h3 class="turns-header">Turns
        <span class="turns-count" *ngIf="turns.length > 0">
          ({{turns.length}}/5)
        </span>
      </h3>
      
      <div class="turn-options">
        <select class="turn-select" [(ngModel)]="selectedTurn">
          <option value="">Select Turn Type</option>
          <option *ngFor="let type of turnTypes" [value]="type">
            {{type}}
          </option>
        </select>
        <button class="add-turn-button" 
                (click)="addNewTurn()" 
                [disabled]="!selectedTurn || turns.length >= 5">
          Add
        </button>
      </div>

      <div class="turns-list" cdkDropList (cdkDropListDropped)="onDrop($event)">
        <div class="turn-item" 
             *ngFor="let turn of turns; let i = index"
             cdkDrag>
          <div class="drag-handle">⋮</div>  <!-- Opcionális fogó ikon -->
          <span>{{ turn.name }}</span>
          <div class="turn-actions">
            <button class="edit-turn-button" (click)="editTurn(turn)">Edit</button>
            <button class="remove-turn-button" (click)="removeTurn(i)">✕</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>